<html>

<head>
  <link rel="stylesheet" href="css/bootstrap.min.css">
  <link rel="stylesheet" href="css/formio.full.min.css">
  <link rel="stylesheet" href="css/app.css">
  <link rel="stylesheet" href="css/quill.snow.css">
  <script src="js/formio.full.min.js"></script>
  <script src="js/jquery.min.js"></script>
  <script src="js/loadJsonForm.js"></script>
  <script src="js/quill.min.js"></script>

  <style>
    .ql-container {
      height: auto !important;
    }

    .ql-editor {
      height: auto !important;

    }
  </style>
</head>

<body>

  <div class="container-fuild">
    <div class="jumbotron">
      <h1 style="text-align:center">MAIL FORM</h1>
    </div>
    <div class="col-lg-offset-2 col-lg-8" id="formio"></div>
    <br>
    <br>
  </div>

  <script type="text/javascript">

    Formio.createForm(document.getElementById('formio'), arrForm).then(function (instance) {

      // ------------------------------------------------------------------------------------------
      // Trigger on submit event.
      // ------------------------------------------------------------------------------------------

      instance.on('submit', (submission) => {
        var id_token = getParameterByName('id_token', window.location.href);
        var settings = {
          "async": true,
          "crossDomain": true,
          "url": "https://togetherservice.azurewebsites.net/api/callsp",
          "method": "POST",
          "headers": {
            "content-type": "application/json",
            "authorization": "Bearer " + id_token,
            "cache-control": "no-cache"
          },
          "processData": false,
          "data": "{\n    \"sender\": \"" + submission.data.panelFrom + "\",\n    \"receiver\": \"" + submission.data.panelTo + "\",\n    \"subject\": \"" + submission.data.panelSubject + "\",\n    \"attachment_url\": \"" + submission.data.panelAttachment + "\",\n    \"body\": \"" + submission.data.panelTextareaField + "\"\n}"
        }

        $.ajax(settings).done(function () {
          form.setAlert('success', 'The mail has been sent successfully.');
          alert('The mail has been sent successfully.');
          form.reset();
          form.render();
          console.log("success");
        }).fail(function (error) {
          form.setAlert('danger', 'Unsent the email');
        });
      });
    });

    function getParameterByName(name, url) {
      if (!url) url = window.location.href;
      name = name.replace(/[\[\]]/g, "\\$&");
      var regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)"),
        results = regex.exec(url);
      if (!results) return null;
      if (!results[2]) return '';
      return decodeURIComponent(results[2].replace(/\+/g, " "));
    }

  </script>
</body>

</html>